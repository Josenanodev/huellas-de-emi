---
import Layout from '../../layouts/Layout.astro';
import type { Dog } from '../../types';

const { id } = Astro.params;
const apiUrl = import.meta.env.DEV ? 'http://localhost:4321' : '';

let dog: Dog | null = null;
let error: string | null = null;

try {
  const response = await fetch(`${apiUrl}/api/dogs/${id}`);
  if (response.ok) {
    dog = await response.json();
  } else {
    error = 'Perro no encontrado';
  }
} catch (e) {
  error = 'Error al cargar el perro';
}
---

<Layout title={dog ? dog.name : 'Perro'}>
  <div class="container">
    {error ? (
      <div class="error">{error}</div>
    ) : dog ? (
      <div class="dog-detail">
        <div class="dog-detail-header">
          <div class="dog-detail-images">
            {dog.images.length > 0 ? (
              dog.images.map((image: string) => (
                <img src={image} alt={dog.name} class="dog-detail-image" />
              ))
            ) : (
              <img src="/images/default-dog.svg" alt={dog.name} class="dog-detail-image" />
            )}
          </div>
          
          <div class="dog-detail-info">
            <h1>{dog.name}</h1>
            <p>
              <span class={`dog-status status-${dog.status}`}>
                {dog.status === 'available' && 'Disponible'}
                {dog.status === 'adopted' && 'Adoptado'}
                {dog.status === 'in_treatment' && 'En Tratamiento'}
                {dog.status === 'reserved' && 'Reservado'}
              </span>
            </p>
            
            <div class="info-grid">
              <div class="info-item">
                <strong>Raza</strong>
                {dog.breed}
              </div>
              <div class="info-item">
                <strong>Edad</strong>
                {dog.age} {dog.age === 1 ? 'a√±o' : 'a√±os'}
              </div>
              <div class="info-item">
                <strong>G√©nero</strong>
                {dog.gender === 'male' ? 'Macho' : 'Hembra'}
              </div>
              <div class="info-item">
                <strong>Tama√±o</strong>
                {dog.size === 'small' && 'Peque√±o'}
                {dog.size === 'medium' && 'Mediano'}
                {dog.size === 'large' && 'Grande'}
              </div>
              <div class="info-item">
                <strong>Vacunado</strong>
                {dog.vaccinated ? 'S√≠' : 'No'}
              </div>
              <div class="info-item">
                <strong>Esterilizado</strong>
                {dog.sterilized ? 'S√≠' : 'No'}
              </div>
            </div>
          </div>
        </div>
        
        <div>
          <h2>Sobre {dog.name}</h2>
          <p>{dog.description}</p>
          
          {dog.personality && (
            <div>
              <h3>Personalidad</h3>
              <p>{dog.personality}</p>
            </div>
          )}
          
          {dog.healthConditions.length > 0 && (
            <div>
              <h3>Condiciones de Salud</h3>
              <ul>
                {dog.healthConditions.map((condition: string) => (
                  <li>{condition}</li>
                ))}
              </ul>
            </div>
          )}
          
          {dog.specialCare && (
            <div>
              <h3>Cuidados Especiales</h3>
              <p>{dog.specialCare}</p>
            </div>
          )}
        </div>
        
        {dog.status === 'available' && (
          <div class="contact-section">
            <h2>¬øInteresado en adoptar a {dog.name}?</h2>
            <p>Cont√°ctanos por WhatsApp para m√°s informaci√≥n sobre la adopci√≥n.</p>
            <a 
              href={`https://wa.me/+523313296314?text=Hola, me gustar√≠a obtener m√°s informaci√≥n sobre la adopci√≥n de ${dog.name}.`}
              target="_blank"
              rel="noopener noreferrer"
              class="btn"
            >
              üí¨ Enviar por WhatsApp
            </a>
          </div>
        )}
      </div>
    ) : null}
    
    <div style="margin-top: 2rem;">
      <a href="/" class="btn btn-secondary">‚Üê Volver a la lista</a>
    </div>
  </div>
</Layout>
