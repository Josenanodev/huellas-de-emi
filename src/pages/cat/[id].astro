---
import Layout from '../../layouts/Layout.astro';
import type { Cat } from '../../types';

const { id } = Astro.params;

let cat: Cat | null = null;
let error: string | null = null;

try {
  const catApiUrl = new URL(`/api/cats/${id}`, Astro.url).toString();
  const response = await fetch(catApiUrl);
  if (response.ok) {
    cat = await response.json();
  } else {
    error = 'Gato no encontrado';
  }
} catch (e) {
  error = 'Error al cargar el gato';
}
---

<Layout title={cat ? cat.name : 'Gato'}>
  <div class="container">
    {error ? (
      <div class="error">{error}</div>
    ) : cat ? (
      <div class="dog-detail">
        <div class="dog-detail-header">
          <div class="dog-detail-images">
            {cat.images.length > 0 ? (
              cat.images.map((image: string) => (
                <img src={image} alt={cat.name} class="dog-detail-image" />
              ))
            ) : (
              <img src="/images/default-dog.svg" alt={cat.name} class="dog-detail-image" />
            )}
          </div>
          
          <div class="dog-detail-info">
            <h1>{cat.name}</h1>
            <p>
              <span class={`dog-status status-${cat.status}`}>
                {cat.status === 'available' && 'Disponible'}
                {cat.status === 'adopted' && 'Adoptado'}
                {cat.status === 'in_treatment' && 'En Tratamiento'}
                {cat.status === 'reserved' && 'Reservado'}
              </span>
            </p>
            
            <div class="info-grid">
              <div class="info-item">
                <strong>ğŸˆ Raza</strong>
                {cat.breed}
              </div>
              <div class="info-item">
                <strong>ğŸ‚ Edad</strong>
                {cat.age} {cat.age === 1 ? 'aÃ±o' : 'aÃ±os'}
              </div>
              <div class="info-item">
                <strong>âš¥ GÃ©nero</strong>
                {cat.gender === 'male' ? 'Macho' : 'Hembra'}
              </div>
              <div class="info-item">
                <strong>ğŸ“ TamaÃ±o</strong>
                {cat.size === 'small' && 'PequeÃ±o'}
                {cat.size === 'medium' && 'Mediano'}
                {cat.size === 'large' && 'Grande'}
              </div>
              <div class="info-item">
                <strong>ğŸ’‰ Vacunado</strong>
                {cat.vaccinated ? 'âœ… SÃ­' : 'âŒ No'}
              </div>
              <div class="info-item">
                <strong>âœ‚ï¸ Esterilizado</strong>
                {cat.sterilized ? 'âœ… SÃ­' : 'âŒ No'}
              </div>
            </div>
          </div>
        </div>
        
        <div>
          <h2>ğŸ“– Sobre {cat.name}</h2>
          <p>{cat.description}</p>

          {cat.personality && (
            <div>
              <h3>âœ¨ Personalidad</h3>
              <p>{cat.personality}</p>
            </div>
          )}

          {cat.healthConditions.length > 0 && (
            <div>
              <h3>ğŸ¥ Condiciones de Salud</h3>
              <ul>
                {cat.healthConditions.map((condition: string) => (
                  <li>{condition}</li>
                ))}
              </ul>
            </div>
          )}

          {cat.specialCare && (
            <div>
              <h3>ğŸ’Š Cuidados Especiales</h3>
              <p>{cat.specialCare}</p>
            </div>
          )}
        </div>

        {cat.status === 'available' && (
          <div class="contact-section">
            <h2>ğŸ’Œ Â¿Interesado en adoptar a {cat.name}?</h2>
            <p>ContÃ¡ctanos por WhatsApp para mÃ¡s informaciÃ³n sobre la adopciÃ³n.</p>
            <a
              href={`https://wa.me/+523313296314?text=Hola, me gustarÃ­a obtener mÃ¡s informaciÃ³n sobre la adopciÃ³n de ${cat.name}.`}
              target="_blank"
              rel="noopener noreferrer"
              class="btn whatsapp-btn"
            >
              ğŸ’¬ Enviar por WhatsApp
            </a>
          </div>
        )}
      </div>
    ) : null}
    
    <div style="margin-top: 2rem;">
      <a href="/cats" class="btn btn-secondary">â† Volver a la lista</a>
    </div>
  </div>
</Layout>
