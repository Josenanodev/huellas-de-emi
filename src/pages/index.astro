---
import Layout from "../layouts/Layout.astro";
import type { Dog } from "../types";

let dogs: Dog[] = [];

try {
  const dogsApiUrl = new URL("/api/dogs", Astro.url).toString();
  const response = await fetch(dogsApiUrl);
  const data: unknown = await response.json();
  dogs = Array.isArray(data) ? data : [];
} catch (error) {
  console.error("Failed to load dogs on homepage:", error);
}
---

<Layout title="Inicio">
  <div class="container">
    <h1>üêæ Perros en Adopci√≥n</h1>
    <p>Conoce a nuestros adorables perros que est√°n buscando un hogar lleno de amor.</p>

    {
      dogs.length === 0 ? (
        <p>No hay perros disponibles en este momento.</p>
      ) : (
        <div class="dogs-grid">
          {dogs.map((dog) => (
            <div class="dog-card">
              <img
                src={dog.images[0] || "/images/default-dog.svg"}
                alt={dog.name}
                class="dog-image"
              />
              <div class="dog-info">
                <h2 class="dog-name">{dog.name}</h2>
                <p class="dog-breed">{dog.breed}</p>
                <p>
                  <span class={`dog-status status-${dog.status}`}>
                    {dog.status === "available" && "Disponible"}
                    {dog.status === "adopted" && "Adoptado"}
                    {dog.status === "in_treatment" && "En Tratamiento"}
                    {dog.status === "reserved" && "Reservado"}
                  </span>
                </p>
                <p>{dog.description.substring(0, 100)}...</p>
                <a href={`/dog/${dog._id}`} class="btn">
                  Ver m√°s
                </a>
              </div>
            </div>
          ))}
        </div>
      )
    }
  </div>
</Layout>
